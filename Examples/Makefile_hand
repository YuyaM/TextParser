# -*- mode: makefile -*-
.PHONY: all clean mpi

##########################
# Settings for generic
CXXFLAGS+=-I../include
CXXLDFLAGS+=-L../src -lTextParser
CCFLAGS+=-I../include
CCLDFLAGS+=-L../src -lstdc++ -lTextParser
FCFLAGS+=-I../include
FCLDFLAGS+=-L../src -lstdc++ -lTextParser_f90api -lTextParser
CXXLINKER=$(CXX)
CCLINKER=$(CC)
FCLINKER=$(FC)

##########################
# Settings for FX10
#CXXFLAGS+=-I../include
#CXXLDFLAGS+=-L../src -lTextParser
#CCFLAGS+=-I../include
#CCLDFLAGS+=-L../src -lTextParser
#FCFLAGS+=-I../include
#FCLDFLAGS+=-L../src --linkfortran -lTextParser_f90api -lTextParser
#CXX=FCCpx
#CC=fccpx
#FC=frtpx
#MPICXX=mpiFCCpx
#CXXLINKER=$(CXX)
#CCLINKER=$(CXX)
#FCLINKER=$(CXX)

##########################
# suffix rules
.SUFFIXES:.o .cpp .c .f90

.cpp.o:
	$(CXX) -c $< $(CXXFLAGS)

.c.o:
	$(CC) -c $< $(CCFLAGS)

.f90.o:
	$(FC) -c $< $(FCFLAGS)

CXXOBJS=Example1_cpp.o \
Example2_cpp.o \
Example3_cpp.o \
Example4_cpp.o 
CXXTARGET=$(CXXOBJS:.o=)

COBJS=Example1_c.o \
Example2_c.o \
Example3_c.o \
Example4_c.o
CTARGET=$(COBJS:.o=)

FOBJS=Example1_f90.o \
Example2_f90.o \
Example3_f90.o \
Example4_f90.o
FTARGET=$(FOBJS:.o=)

all: $(CXXTARGET) $(CTARGET) $(FTARGET) 

Example1_cpp:Example1_cpp.o
	$(CXXLINKER) -o $@ $^ $(CXXLDFLAGS)
Example2_cpp:Example2_cpp.o
	$(CXXLINKER) -o $@ $^ $(CXXLDFLAGS)
Example3_cpp:Example3_cpp.o
	$(CXXLINKER) -o $@ $^ $(CXXLDFLAGS)
Example4_cpp:Example4_cpp.o
	$(CXXLINKER) -o $@ $^ $(CXXLDFLAGS)

Example1_c:Example1_c.o
	$(CCLINKER) -o $@ $^ $(CCLDFLAGS)
Example2_c:Example2_c.o
	$(CCLINKER) -o $@ $^ $(CCLDFLAGS)
Example3_c:Example3_c.o
	$(CCLINKER) -o $@ $^ $(CCLDFLAGS) 
Example4_c:Example4_c.o
	$(CCLINKER) -o $@ $^ $(CCLDFLAGS)

Example1_f90:Example1_f90.o
	$(FCLINKER) -o $@ $^ $(FCLDFLAGS)
Example2_f90:Example2_f90.o
	$(FCLINKER) -o $@ $^ $(FCLDFLAGS)
Example3_f90:Example3_f90.o
	$(FCLINKER) -o $@ $^ $(FCLDFLAGS)
Example4_f90:Example4_f90.o
	$(FCLINKER) -o $@ $^ $(FCLDFLAGS)


mpi:Example3_cpp_mpi


Example3_cpp_mpi:Example3_cpp_mpi.cpp
	$(MPICXX) -DENABLE_MPI -o $@ $^  -I ../include -L../src -lTextParser_mpi

clean:
	-rm $(CXXOBJS) $(COBJS) $(FOBJS) $(CXXTARGET) $(CTARGET) $(FTARGET) Example3_cpp_mpi
